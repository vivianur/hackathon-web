services:
  # Dashboard microfrontend
  dashboard:
    build:
      context: .
      dockerfile: docker/Dockerfile.remote
      args:
        APP_NAME: dashboard
    container_name: mindease-dashboard
    restart: unless-stopped
    networks:
      - mindease-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://127.0.0.1:80/assets/remoteEntry.js"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Tasks microfrontend
  tasks:
    build:
      context: .
      dockerfile: docker/Dockerfile.remote
      args:
        APP_NAME: tasks
    container_name: mindease-tasks
    restart: unless-stopped
    networks:
      - mindease-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://127.0.0.1:80/assets/remoteEntry.js"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Profile microfrontend
  profile:
    build:
      context: .
      dockerfile: docker/Dockerfile.remote
      args:
        APP_NAME: profile
    container_name: mindease-profile
    restart: unless-stopped
    networks:
      - mindease-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://127.0.0.1:80/assets/remoteEntry.js"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Shell (host) - main entry point
  shell:
    build:
      context: .
      dockerfile: docker/Dockerfile.shell
      args:
        DASHBOARD_URL: http://localhost:3000/mf/dashboard/assets/remoteEntry.js
        TASKS_URL: http://localhost:3000/mf/tasks/assets/remoteEntry.js
        PROFILE_URL: http://localhost:3000/mf/profile/assets/remoteEntry.js
    container_name: mindease-shell
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:80"
    depends_on:
      dashboard:
        condition: service_healthy
      tasks:
        condition: service_healthy
      profile:
        condition: service_healthy
    networks:
      - mindease-network

networks:
  mindease-network:
    driver: bridge
